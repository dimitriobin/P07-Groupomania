(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chat"],{"1a6b":function(e,t,s){"use strict";s("8140")},"23ad":function(e,t,s){!function(t,s){e.exports=s()}(0,(function(){"use strict";var e={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(t,s,n){var a=s.prototype,r=a.format;n.en.formats=e,a.format=function(t){void 0===t&&(t="YYYY-MM-DDTHH:mm:ssZ");var s=this.$locale().formats,n=function(t,s){return t.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(function(t,n,a){var r=a&&a.toUpperCase();return n||s[a]||e[a]||s[r].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(function(e,t,s){return t||s.slice(1)}))}))}(t,void 0===s?{}:s);return r.call(this,n)}}}))},"251e":function(e,t,s){"use strict";s("6fbb")},"293a":function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-row",{staticClass:"rounded-lg shadow h-100",attrs:{tag:"main",id:"chat"}},[s("b-col",{staticClass:"h-100 border-right flex-column justify-content-between",class:{"d-none d-lg-flex":e.currentConversation,"d-flex":!e.currentConversation},attrs:{cols:"12",lg:"4"}},[s("div",{staticClass:"d-flex justify-content-between align-items-center p-2"},[s("h1",{staticClass:"h3"},[e._v("Discussions")]),s("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.onlineUsers",modifiers:{onlineUsers:!0}}],staticClass:"bg-transparent border-0"},[s("b-icon-pencil-square",{staticClass:"text-dark",attrs:{"aria-label":"Démarrer une conversation avec un collègue","font-scale":"1.5"}})],1),s("b-modal",{attrs:{id:"onlineUsers",title:"Avec qui voulez-vous discutter ?","hide-footer":"",centered:"",scrollable:"","content-class":"h-100"}},[s("ChatUser",{on:{conversationCreated:function(t){return e.$bvModal.hide("onlineUsers")}}})],1)],1),s("ChatConversations")],1),0!==e.currentConversation?s("b-col",{staticClass:"h-100 d-flex flex-column justify-content-between align-items-stretch"},[s("ChatHeader"),s("ChatMessages"),s("form",{staticClass:"d-flex justify-content-between align-items-center position-relative",on:{submit:e.sendMessage}},[s("b-form-input",{staticClass:"my-3 w-100",attrs:{"aria-label":"Envoyer un nouveau message"},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}}),s("b-button",{staticClass:"input__btn",attrs:{type:"submit",variant:"link"}},[e._v("Envoyer")])],1)],1):s("b-col",{staticClass:"h-100 d-none d-lg-flex flex-column justify-content-center align-items-center"},[s("h2",[e._v("Vos messages")]),s("p",[e._v("Créer une nouvelle conversation avec vos collègues ")]),s("b-button",{attrs:{variant:"dark",pill:""},on:{click:function(t){return e.$bvModal.show("onlineUsers")}}},[e._v(" Créer une conversation ")])],1)],1)},a=[],r=s("5530"),i=s("3835"),o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"h-100 d-flex flex-column justify-between align-items-stretch"},[s("b-list-group",{staticClass:"overflow-y-auto overflow-x-hidden",attrs:{id:"onlineUsersList"}},e._l(e.allOtherUsers,(function(t,n){return s("b-list-group-item",{key:n,staticClass:"border-0 rounded-pill text-dark d-flex justify-content-start align-items-center",class:{active:e.selectedUser===t.id},attrs:{href:"#"},on:{click:function(s){e.selectedUser=t.id}}},[s("b-avatar",{staticClass:"mr-3 bg-transparent",attrs:{badge:e.isOnline(t.id),"badge-variant":"success",src:t.image_url,size:"3.5rem"}}),s("div",[s("p",{staticClass:"m-0 h5"},[e._v(e._s(t.user_name))])])],1)})),1),s("div",{staticClass:"mt-2 w-100"},[s("b-button",{staticClass:"d-block mx-auto",attrs:{variant:"success",size:"lg"},on:{"~click":function(t){return e.handleSubmit()}}},[e._v(" Démarrer une conversation ")])],1)],1)},c=[],l=(s("4de4"),s("2f62")),u={name:"ChatUser",data:function(){return{selectedUser:""}},computed:Object(r["a"])(Object(r["a"])({},Object(l["c"])(["userId","allUsers","allOnlineUsers"])),{},{allOtherUsers:function(){var e=this;return this.allUsers.filter((function(t){return t.id!==e.userId}))}}),methods:Object(r["a"])(Object(r["a"])({},Object(l["b"])(["createConversation"])),{},{isOnline:function(e){var t=this.allOnlineUsers.filter((function(t){return t.userId===e}));return t.length>0},handleSubmit:function(){var e=this;this.createConversation([this.selectedUser,this.userId]).then((function(){return e.$emit("conversationCreated")}))}})},d=u,f=(s("5d90"),s("2877")),v=Object(f["a"])(d,o,c,!1,null,"ce313674",null),h=v.exports,m=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"pt-0 px-sm-3 px-md-4 d-flex flex-column justify-content-end align-items-stretch",attrs:{id:"chatMessages"}},[e.conversation.Messages.length&&e.conversation.Messages.length<e.conversation.totalMessages?s("LazyLoadingScroll",{on:{loadMore:function(t){return e.handleLoading(t)}}}):s("p",{staticClass:"text-center my-4 text-muted"},[e._v(" "+e._s(e.conversation.Messages.length>0?"Fin des messages":"Cette conversation ne contient aucun message")+" ")]),e._l(e.conversation.Messages,(function(t,n){return s("p",{key:n,staticClass:"d-flex flex-column justify-content-center align-items-start"},[s("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"bg-light px-4 py-2 rounded-pill w-auto text-break mw-70",class:{"message-sent":t.UserId===e.userId},attrs:{title:e.formatDate(t.createdAt)}},[e._v(" "+e._s(t.content)+" ")]),e.lastMessageSent&&e.lastMessageSent.id===t.id&&!0===t.read&&t.UserId===e.userId?s("span",{staticClass:"align-self-end"},[s("b-icon-check-all"),s("small",[e._v(" vu le "+e._s(e.formatDate(t.updatedAt))+" ")])],1):e._e(),n===e.conversation.Messages.length-1&&!1===t.read&&t.UserId===e.userId?s("span",{staticClass:"align-self-end"},[s("b-icon-check"),s("small",[e._v(" envoyé le "+e._s(e.formatDate(t.createdAt))+" ")])],1):e._e()])}))],2)},b=[],g=(s("fb6a"),s("ffa7")),C=s("5a0c"),p=s.n(C),M=s("e5b7"),_=s.n(M),j=s("23ad"),O=s.n(j);p.a.extend(O.a),p.a.locale(_.a);var x={name:"ChatMessages",components:{LazyLoadingScroll:g["a"]},data:function(){return{down:!0}},watch:{currentConversation:function(){this.down=!0}},computed:Object(r["a"])(Object(r["a"])({},Object(l["c"])(["userId","allConversations","currentConversation","socket"])),{},{conversation:function(){var e=this;return this.allConversations.filter((function(t){return t.id===e.currentConversation}))[0]},lastMessageSent:function(){var e=this,t=this.conversation.Messages.filter((function(t){return t.UserId===e.userId})),s=t.slice().sort((function(e,t){return p()(t.createdAt).unix()-p()(e.createdAt).unix()})),n=Object(i["a"])(s,1),a=n[0];return a}}),methods:Object(r["a"])(Object(r["a"])({},Object(l["b"])(["readAllMessagesByConversation"])),{},{scrollDown:function(){var e=document.querySelector("#chatMessages");e.scrollTop=e.scrollHeight},scrollAdjust:function(){var e=document.querySelector("#chatMessages");e.scrollTop=e.scrollHeight-e.scrollTop},formatDate:function(e){return p()(e).format("LLL")},handleLoading:function(e){var t=this;this.down=!1,this.readAllMessagesByConversation({conversationId:this.conversation.id,page:e}).then((function(){t.down=!0}))}}),mounted:function(){},updated:function(){this.down?this.scrollDown():this.scrollAdjust()}},U=x,w=(s("1a6b"),Object(f["a"])(U,m,b,!1,null,"53440a30",null)),y=w.exports,k=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-list-group",{staticClass:"flex-grow-1",attrs:{id:"conversationsList"}},[s("h2",{staticClass:"sr-only"},[e._v("Vos conversations en cours")]),e._l(e.allConversationsSortByNew,(function(t,n){return s("b-list-group-item",{key:n,staticClass:"border-0 rounded-pill text-dark d-flex justify-content-start align-items-center",attrs:{href:"#",active:e.currentConversation===t.id},on:{"~click":function(s){return e.readAllMessagesByConversation({conversationId:t.id,page:0})},click:function(s){return e.handleClick(t.id)}}},[s("b-avatar",{staticClass:"mr-3 bg-transparent",attrs:{badge:e.isOnline(t.Users),"badge-variant":"success",src:e.participants(t.Users)[0].image_url,size:"3.5rem"}}),s("div",[s("h3",{staticClass:"m-0 h5"},[e._v(" "+e._s(e.participants(t.Users)[0].user_name)+" "),e.participants(t.Users)[1]?s("span",[e._v(", "+e._s(e.participants(t.Users)[1].user_name))]):e._e(),e.participants(t.Users).length>3?s("span",[e._v(", ...")]):e._e()]),t.Messages.length?s("p",{staticClass:"text-muted m-0"},[e._v(" "+e._s(t.Messages[t.Messages.length-1].content)+" ")]):e._e(),t.Messages.length?s("small",[e._v(" "+e._s(e.formatDate(t.Messages[t.Messages.length-1].createdAt))+" ")]):e._e()]),e.unreadMessages(t.Messages)?s("b-icon-circle-fill",{staticClass:"ml-auto text-info",attrs:{"font-scale":"1"}}):e._e()],1)}))],2)},I=[],L=(s("7db0"),s("45fc"),s("4208")),A=s.n(L);p.a.extend(A.a);var D={name:"ChatConversations",computed:Object(r["a"])(Object(r["a"])({},Object(l["c"])(["allConversations","userId","allOnlineUsers","currentConversation"])),{},{allConversationsSortByNew:function(){return this.allConversations.slice().sort((function(e,t){var s=e.Messages.length?p()(e.Messages[e.Messages.length-1].createdAt).unix():0,n=t.Messages.length?p()(t.Messages[t.Messages.length-1].createdAt).unix():0;return n-s}))}}),methods:Object(r["a"])(Object(r["a"])(Object(r["a"])({},Object(l["b"])(["readAllMessagesByConversation"])),Object(l["d"])(["setCurrentConversation"])),{},{participants:function(e){var t=this;return e.filter((function(e){return e.id!==t.userId}))},isOnline:function(e){var t=this,s=e.filter((function(e){return e.id!==t.userId})),n=this.allOnlineUsers.find((function(e){return e.userId===s[0].id}));return void 0!==n},unreadMessages:function(e){var t=this;return e.some((function(e){return!1===e.read&&e.UserId!==t.userId}))},formatDate:function(e){return p()(e).fromNow()},handleClick:function(e){this.setCurrentConversation(e)}})},Y=D,S=(s("251e"),Object(f["a"])(Y,k,I,!1,null,"3ee9a994",null)),$=S.exports,E=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"p-2 p-sm-3 p-lg-4 d-flex align-items-center"},[s("b-button",{staticClass:"text-dark mr-1 mr-lg-0 d-lg-none",attrs:{variant:"link"}},[s("b-icon-arrow-left",{attrs:{"aria-label":"Revenir à la liste des conversations","font-scale":"1.5"},on:{click:function(t){return e.setCurrentConversation(0)}}})],1),s("b-avatar",{staticClass:"mr-3 bg-transparent",attrs:{src:e.otherUsers[0].image_url,size:"2.5rem"}}),s("h2",{staticClass:"h5 m-0"},[s("span",{staticClass:"sr-only"},[e._v("Conversation avec ")]),e._v(e._s(e.usersNames))])],1)},z=[],H=(s("4160"),s("a15b"),s("159b"),{name:"ChatHeader",computed:Object(r["a"])(Object(r["a"])({},Object(l["c"])(["userId","currentConversation","allConversations"])),{},{otherUsers:function(){var e=this,t=this.allConversations.filter((function(t){return t.id===e.currentConversation})),s=Object(i["a"])(t,1),n=s[0];return n.Users.filter((function(t){return t.id!==e.userId}))},usersNames:function(){var e=[];return this.otherUsers.forEach((function(t){return e.push(t.user_name)})),e.join(", ")}}),methods:Object(r["a"])({},Object(l["d"])(["setCurrentConversation"]))}),N=H,T=Object(f["a"])(N,E,z,!1,null,null,null),B=T.exports,q={name:"Chat",components:{ChatUser:h,ChatMessages:y,ChatConversations:$,ChatHeader:B},data:function(){return{message:""}},watch:{currentConversation:function(e){var t=this;0!==this.currentConversation&&(this.socket.emit("subscribe",this.currentConversation),this.updateConversationAsRead(e).then((function(e){if(t.unreadCount>0){var s=Object(i["a"])(e.updated,1),n=s[0];t.setUnreadCount(t.unreadCount-n)}})))}},computed:Object(r["a"])({},Object(l["c"])(["userId","currentConversation","socket","unreadCount"])),methods:Object(r["a"])(Object(r["a"])(Object(r["a"])({},Object(l["b"])(["fetchUser","fetchAllUsers","createMessage","updateConversationAsRead"])),Object(l["d"])(["setUnreadCount"])),{},{sendMessage:function(e){e.preventDefault(),this.createMessage({content:this.message}),this.message=""}}),mounted:function(){this.fetchUser(this.userId),this.fetchAllUsers()}},R=q,J=(s("ed26"),Object(f["a"])(R,n,a,!1,null,"12b8a5ea",null));t["default"]=J.exports},"5d90":function(e,t,s){"use strict";s("f708")},"6fbb":function(e,t,s){},8140:function(e,t,s){},a15b:function(e,t,s){"use strict";var n=s("23e7"),a=s("44ad"),r=s("fc6a"),i=s("a640"),o=[].join,c=a!=Object,l=i("join",",");n({target:"Array",proto:!0,forced:c||!l},{join:function(e){return o.call(r(this),void 0===e?",":e)}})},b772:function(e,t,s){},ed26:function(e,t,s){"use strict";s("b772")},f708:function(e,t,s){}}]);
//# sourceMappingURL=chat.b1b78197.js.map